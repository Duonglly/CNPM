<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Chi Ti·∫øt ƒê·∫∑t Ph√≤ng #{{ booking.id }}</title>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
      rel="stylesheet"
    />
    <style>
      :root {
        --primary: #c8102e;
        --primary-dark: #a00d26;
        --secondary: #f8f9fa;
        --text-dark: #333;
        --text-light: #666;
        --border: #e0e0e0;
        --success: #28a745;
        --warning: #ffc107;
        --danger: #dc3545;
        --info: #0d6efd;
      }
      body {
        font-family: Arial, sans-serif;
        background-color: var(--secondary);
        padding: 20px;
      }
      .container {
        max-width: 1000px;
        margin: 40px auto;
        background: white;
        padding: 30px;
        border-radius: 10px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      }
      h1 {
        color: var(--primary);
        border-bottom: 3px solid var(--border);
        padding-bottom: 10px;
        margin-bottom: 30px;
        font-size: 28px;
      }
      h2 {
        color: var(--text-dark);
        margin-top: 25px;
        margin-bottom: 15px;
        font-size: 22px;
      }
      .card-section {
        border: 1px solid var(--border);
        border-radius: 8px;
        margin-bottom: 25px;
        padding: 20px;
      }

      /* Th√¥ng tin c∆° b·∫£n */
      .booking-info {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
      }
      .info-item {
        padding: 10px 0;
        border-bottom: 1px dashed var(--border);
      }
      .info-item:last-child {
        border-bottom: none;
      }
      .info-item strong {
        display: block;
        color: var(--text-light);
        font-size: 14px;
        margin-bottom: 3px;
      }
      .info-item span {
        font-weight: 600;
        color: var(--text-dark);
        font-size: 16px;
      }

      /* Tr·∫°ng th√°i ƒë·∫∑t ph√≤ng */
      .status-badge {
        display: inline-block;
        padding: 6px 15px;
        border-radius: 20px;
        font-weight: bold;
        font-size: 14px;
        text-transform: uppercase;
        margin-top: 5px;
      }
      .status-pending {
        background-color: var(--warning);
        color: white;
      }
      .status-confirmed {
        background-color: var(--success);
        color: white;
      }
      .status-cancelled {
        background-color: var(--danger);
        color: white;
      }
      .status-checked-in {
        background-color: var(--info);
        color: white;
      }
      .status-completed {
        background-color: var(--primary);
        color: white;
      }

      /* Timeline */
      .timeline {
        position: relative;
        padding: 20px 0;
        margin-left: 20px;
      }
      .timeline::before {
        content: "";
        position: absolute;
        top: 0;
        bottom: 0;
        left: 0;
        width: 3px;
        background-color: var(--border);
      }
      .timeline-item {
        position: relative;
        padding-left: 30px;
        margin-bottom: 25px;
      }
      .timeline-icon {
        position: absolute;
        left: -12px;
        top: 0;
        width: 25px;
        height: 25px;
        border-radius: 50%;
        background: white;
        border: 4px solid var(--primary);
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--primary);
        font-size: 12px;
      }
      .timeline-item.active .timeline-icon {
        background-color: var(--primary);
        color: white;
        border-color: var(--primary-dark);
      }
      .timeline-content h4 {
        margin: 0 0 5px 0;
        font-size: 16px;
        font-weight: 600;
        color: var(--text-dark);
      }
      .timeline-content p {
        margin: 0;
        font-size: 13px;
        color: var(--text-light);
      }

      /* Price Breakdown */
      .price-breakdown table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 15px;
      }
      .price-breakdown th,
      .price-breakdown td {
        padding: 12px 0;
        text-align: left;
        border-bottom: 1px solid var(--border);
      }
      .price-breakdown th {
        background-color: var(--secondary);
        font-weight: 600;
        color: var(--text-dark);
      }
      .price-breakdown tr:last-child td {
        border-bottom: none;
      }
      .price-breakdown .total-row td {
        font-weight: bold;
        color: var(--primary);
        font-size: 18px;
        border-top: 2px solid var(--primary);
      }
      .price-breakdown td:last-child {
        text-align: right;
      }
      .discount-row td {
        color: var(--success);
      }

      /* Responsive */
      @media (max-width: 768px) {
        .booking-info {
          grid-template-columns: 1fr;
        }
        .container {
          margin: 20px 10px;
          padding: 20px;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Chi Ti·∫øt ƒê·∫∑t Ph√≤ng #{{ booking.id }}</h1>

      <div class="card-section">
        <h2>Th√¥ng Tin ƒê·∫∑t Ph√≤ng Ch√≠nh üè®</h2>
        <div class="booking-info">
          <div class="info-item">
            <strong>Kh√°ch s·∫°n</strong>
            <span>{{ booking.hotel_name }}</span>
          </div>
          <div class="info-item">
            <strong>Ph√≤ng ƒë√£ ƒë·∫∑t</strong>
            <span>{{ booking.room_name }}</span>
          </div>
          <div class="info-item">
            <strong>Ng√†y nh·∫≠n ph√≤ng</strong>
            <span>{{ booking.check_in_date }}</span>
          </div>
          <div class="info-item">
            <strong>Ng√†y tr·∫£ ph√≤ng</strong>
            <span>{{ booking.check_out_date }}</span>
          </div>
          <div class="info-item">
            <strong>S·ªë ƒë√™m</strong>
            <span>{{ booking.nights }}</span>
          </div>
          <div class="info-item">
            <strong>S·ªë l∆∞·ª£ng kh√°ch</strong>
            <span
              >{{ booking.guests }} ng∆∞·ªùi l·ªõn, {{ booking.children }} tr·∫ª
              em</span
            >
          </div>
          <div class="info-item">
            <strong>T√™n kh√°ch h√†ng</strong>
            <span>{{ booking.full_name }}</span>
          </div>
          <div class="info-item">
            <strong>Tr·∫°ng th√°i hi·ªán t·∫°i</strong>
            <span>
              <span
                class="status-badge status-{{ booking.status | lower | replace(' ', '-') }}"
              >
                {{ booking.status }}
              </span>
            </span>
          </div>
        </div>
      </div>

      <div class="card-section">
        <h2>L·ªãch S·ª≠ Tr·∫°ng Th√°i (Timeline) ‚è≥</h2>
        <div class="timeline">
          {% for item in booking.history %}
          <div class="timeline-item {% if item.is_current %}active{% endif %}">
            <div class="timeline-icon">
              {% if item.is_current %}
              <i class="fas fa-check"></i>
              {% else %}
              <i class="fas fa-circle"></i>
              {% endif %}
            </div>
            <div class="timeline-content">
              <h4>{{ item.status }}</h4>
              <p>{{ item.date }}</p>
            </div>
          </div>
          {% endfor %}
        </div>
      </div>

      <div class="card-section price-breakdown">
        <h2>Chi Ti·∫øt Gi√° üí∏</h2>
        <table>
          <thead>
            <tr>
              <th colspan="2">M√¥ t·∫£</th>
              <th>Th√†nh ti·ªÅn</th>
            </tr>
          </thead>
          <tbody>
            {% for item in booking.price_details %}
            <tr class="{% if item.type == 'discount' %}discount-row{% endif %}">
              <td colspan="2">{{ item.description }}</td>
              <td>
                {% if item.type == 'discount' %}-{% endif %}{{ item.amount |
                format_currency }}
              </td>
            </tr>
            {% endfor %}

            <tr>
              <td colspan="2">Gi√° ph√≤ng ({{ booking.nights }} ƒë√™m)</td>
              <td>{{ booking.room_price_base | format_currency }}</td>
            </tr>
            <tr class="discount-row">
              <td colspan="2">Gi·∫£m gi√° m√£ khuy·∫øn m√£i (MTA-SALE)</td>
              <td>- {{ booking.discount_amount | format_currency }}</td>
            </tr>
            <tr>
              <td colspan="2">Thu·∫ø VAT (10%)</td>
              <td>{{ booking.tax_amount | format_currency }}</td>
            </tr>

            <tr class="total-row">
              <td colspan="2">T·ªïng c·ªông (ƒê√£ bao g·ªìm thu·∫ø)</td>
              <td>{{ booking.total_price | format_currency }}</td>
            </tr>
          </tbody>
        </table>
      </div>

      <div style="text-align: center; margin-top: 30px">
        {% if booking.status == 'Pending' %}
        <a
          href="{{ url_for('payment', booking_id=booking.id) }}"
          class="btn"
          style="
            background: var(--success);
            color: white;
            padding: 12px 30px;
            border-radius: 5px;
            text-decoration: none;
            font-weight: bold;
          "
          >Ti·∫øn h√†nh thanh to√°n</a
        >
        {% endif %} {% if booking.status != 'Cancelled' and booking.status !=
        'Completed' %}
        <button
          onclick="confirmCancel()"
          class="btn"
          style="
            background: var(--danger);
            color: white;
            padding: 12px 30px;
            border-radius: 5px;
            text-decoration: none;
            font-weight: bold;
            margin-left: 15px;
            border: none;
            cursor: pointer;
          "
        >
          H·ªßy ƒë·∫∑t ph√≤ng
        </button>
        {% endif %}
      </div>
    </div>

    <script>
      // H√†m gi·∫£ ƒë·ªãnh ƒë·ªÉ format ti·ªÅn t·ªá (c·∫ßn ƒë∆∞·ª£c ƒë·ªãnh nghƒ©a trong m√¥i tr∆∞·ªùng th·ª±c)
      // Trong m√¥i tr∆∞·ªùng Jinja2, b·∫°n n√™n d√πng filter `format_currency` n·∫øu c√≥.
      function format_currency(amount) {
        return new Intl.NumberFormat("vi-VN", {
          style: "currency",
          currency: "VND",
        }).format(amount);
      }

      // Script x·ª≠ l√Ω n√∫t H·ªßy
      function confirmCancel() {
        if (
          confirm(
            "B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën h·ªßy ƒë·∫∑t ph√≤ng n√†y? Thao t√°c n√†y kh√¥ng th·ªÉ ho√†n t√°c."
          )
        ) {
          // Thay th·∫ø b·∫±ng logic g·ªçi API h·ªßy ƒë·∫∑t ph√≤ng th·ª±c t·∫ø
          alert("ƒê√£ g·ª≠i y√™u c·∫ßu h·ªßy ƒë·∫∑t ph√≤ng. Vui l√≤ng ch·ªù x√°c nh·∫≠n.");
          // window.location.href = "{{ url_for('cancel_booking', booking_id=booking.id) }}";
        }
      }

      // C·∫≠p nh·∫≠t gi√° tr·ªã m·∫´u n·∫øu c·∫ßn thi·∫øt (ch·ªâ d√πng cho m·ª•c ƒë√≠ch demo)
      document.addEventListener("DOMContentLoaded", () => {
        const totalElement = document.querySelector(".total-row td:last-child");
        if (totalElement.textContent.includes("{{ booking.total_price }}")) {
          // Format l·∫°i gi√° tr·ªã t·ªïng ti·ªÅn n·∫øu n√≥ l√† m·ªôt bi·∫øn s·ªë
          // totalElement.textContent = format_currency({{ booking.total_price }});
        }
      });
    </script>
  </body>
</html>
